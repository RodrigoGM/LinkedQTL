LinkedQTL
=========

Simulation of two linked QTL in a single chromosome with varying number of markers, QTL location and effect sizes.


== Submit Scripts ==

cf2_submit_world.slq
	SLURM batch script.  This particular runs both `cf2_make_world.R` and `cf2_analyze_world.R`.
	This script works best where a large number of cores is available.  R will interanlly
	parallelize using an MPI or socket (`SOCK`) cluster.

	```sbatch cf2_submit_world.slq```

cf2_submit_make_world.slq
	SLURM batch script.  This particular run `cf2_make_world.R` only. Launch as :

	```sbatch cf2_submit_make_world.slq```

cf2_submit_cross.i.slq
	SLURM batch script.  This particular run `cf2_analyze_cross.i.R`.  Optional launch depending if
	insalled version of slurm has array support : 

	```sbatch --array=0-1000 cf2_submit_cross.i.slq <PATTERN> ```
	```for i in {0..1000}; do sbatch cf2_submit_cross.i.slq <PATTERN> $i ; done ```


== Main Scripts == 

cf2_make_world.R
	This script generates `reps` number of single chromosome (Congenic) F2 crosses, each with two linked-QTL 15 cM 
	appart. The F2 crosses vary in marker density (96, 384, 1152, and 1536).  Linked-QTL may have either equal QTL
	effects or unequal QTL effects.  Requires a table of linked QTL effects, C-map.RData, and a seed1.RData. File
	CF2-QTL_effects.csv consists of six columns labeled chr, a1, d1, a2, d2, and dist corresponding to the chromosome,
	additive and dominance effects for the first (a1, d1), and second (a2, d2) QTL, and the distance between them. 
	File C-map.RData is an RData file containing four `map` objects generated from sim.map.  File seed1.RData is
	a file containing a random seed to seed all simuations.  The script outputs a csv file containing 9 colums.
	an index (1:reps), loc1, loc2, chr, a1, d1, a2, d2, and dist corresponding to the replicate number (id), location
	of the first QTL, location of the second QTL, additive and dominance for both QTLs, and the distance between both 
	of them.  For purposes of this simulation Q1 is the equal QTL effects model and Q2 is the unequal QTL effects 
	model.
	
cf2_analyze_world.R
	This script analyzes all the cross files generated by the `cf2_make_world.R` script.  Each cross is analyzed
	with Interval Mapping using Haley-Knott regression, Composite Interval Mapping, and stepwise regression/Multiple
	QTL model selection, and generates a summary table for each cross.  In addition, an RData file is created from a
	random sample of crosses for further analysis.  Parallelization is done with the package 'snow' by either MPI or
	scocket (`SOCK`) clusters

cf2_analyze_cross.i.R
	This script is a variant of cf2_analyze_world.R.  The key difference is that this script does not internally
	parallelize interanlly using the package 'snow'.  Instead it uses `--args ${CROSS[$SLURM_ARRAY_TASK_ID]}` 
	where ${CROSS[$SLURM_ARRAY_TASK_ID]} is the name of the cross to be analyzed. Thus, each cross is independently
	analyzed from another, and can be submitted as an SLURM array or `for` loop.


PA_Analysis.R
	Code to perform the power and accuracy analysis for all crosses.  In addition it generates lattice plots for
	visualization of the data.


== Additional functions == 

FileCheck.R
	Script to quickly check if what files are processed and which are remaining to be analyzed.
	
SelectMarkers_V2_3.R
	Function for downsampling a set of markes from a cross.

Make5pheno_V2_3.R
	Functions to create a cross 5 five correlated phenotypes
	
sim.cross.f2.npheno_V2_3.R
	Function to simulate `n` number of phenotypes.  At the moment the n is set to 5, as this function uses 
	Make5pheno_V2_3.R.
	
sim.cross.npheno_V2_3.R
	Function to simulate crosses with five phenotypes.
	
plotmedians.R and plotmedians2.R
	Functions to plot meadians similar to plotmeans from package `gplots`

LinkageAnalysis_V2_3.R
	Functions to implement a linkage analysis with IM and CIM.  Script performs the peak detection and other summary
	functions.

StepwiseAnalysis_V2_3.R
	Functions to implement a linkage analysis using the function stepwiseqtl.  Script performs the peak detection and
	other summary functions
	
mcim_V2_3.R
	Function for replicated composite interval mapping. A copy of this function was moved to LinkageAnalysis_V2_3.R
